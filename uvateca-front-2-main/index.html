<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Uvateca - In√≠cio</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üçá</text></svg>">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header class="main-header">
        <a href="index.html" class="logo">Uvateca</a>
        <nav class="main-nav">
            <ul>
                <li><a href="index.html">In√≠cio</a></li>
                <li><a href="categoria.html">Categoria</a></li>
                <li><a href="about.html">Contato</a></li>
            </ul>
        </nav>
        <div class="user-icon"><a href="#" id="user-icon-btn"><img src="menu.png" class="user-icon-img"></a></div>
    </header>

    <aside id="user-sidebar" class="sidebar">
        <div id="sidebar-logado" class="sidebar-profile" style="display:none;"><img src="perfil.jpeg"><p id="welcome-msg-text"></p></div>
        <div id="sidebar-deslogado" class="sidebar-profile"><p>Voc√™ n√£o est√° logado.</p></div>
        <nav class="sidebar-nav">
            <ul>
                <li id="nav-dashboard" style="display:none;"><a href="dashboard.html">Dashboard</a></li> 
                <li id="nav-gestao-leitores" style="display:none;"><a href="gestao-leitores.html">üë• Gest√£o de Leitores</a></li>
                <li id="nav-acervo" style="display:none;"><a href="gestao-acervo.html">üìö Acervo Bibliogr√°fico</a></li>
                <li id="nav-gestao-emprestimos" style="display:none;"><a href="gestao-emprestimos.html">ü§ù Gest√£o de Empr√©stimos</a></li>
                <li id="nav-gestao-funcionarios" style="display:none;"><a href="gestao-funcionarios.html">üëî Gest√£o de Funcion√°rios</a></li>
                <li id="nav-biblioteca" style="display:none;"><a href="minha-biblioteca.html">Minha Biblioteca</a></li>
                <li id="nav-alugados" style="display:none;"><a href="alugados.html">Meus Alugu√©is</a></li>
                <li id="nav-login"><a href="login.html">Login / Entrar</a></li>
                <li id="nav-logout" style="display:none;"><a href="#">Sair (Logout)</a></li>
            </ul>
        </nav>
    </aside>

    <main>
        <div class="container">
            <h2>Nossa Cole√ß√£o</h2>
            <section class="book-grid" id="lista-livros-dinamica">
                <p style="color: white; text-align: center;">Carregando livros do acervo...</p>
            </section>
        </div>
    </main>

    <div id="modalLivro" class="modal-overlay" onclick="fecharModal(event)">
        <div class="modal-box" onclick="event.stopPropagation()">
            <span class="close-modal" onclick="fecharModal(event)">&times;</span>
            <div class="modal-left"><img id="modal-img" src="" alt="Capa"></div>
            <div class="modal-right">
                <h2 id="modal-titulo" class="modal-title">T√≠tulo</h2>
                <div class="modal-meta">
                    <span id="modal-autor">Autor</span> | <span id="modal-categoria">Cat</span> | <span id="modal-ano">2024</span>
                </div>
                <div class="modal-meta" style="border:none; padding:0; font-size:1rem;">
                    <span id="modal-isbn">ISBN</span> | <span id="modal-edicao">Ed</span> | <span id="modal-qtd">Qtd</span>
                </div>
                <div style="margin-top:30px;">
                    <p class="modal-sinopse-label">Sinopse</p>
                    <p id="modal-sinopse" class="modal-sinopse-text">Desc...</p>
                </div>
                <div class="modal-actions">
                    <button class="modal-action-btn" onclick="irParaContato()">Entre em Contato</button>
                    <button class="modal-action-btn" onclick="adicionarMinhaLista()">Adicionar √† minha lista</button>
                </div>
            </div>
        </div>
    </div>

    <script src="main.js"></script>
    <script>
        const API_URL = "http://localhost:8080/api";
        let livrosGlobal = []; 
        let livroAtual = null;

        async function carregarLivrosDoBanco() {
            const container = document.getElementById('lista-livros-dinamica');
            try {
                const response = await fetch(`${API_URL}/livros`);
                livrosGlobal = await response.json(); 
                container.innerHTML = ''; 
                if (livrosGlobal.length === 0) {
                    container.innerHTML = '<p style="color:white">Nenhum livro encontrado.</p>';
                    return;
                }
                livrosGlobal.forEach((livro, index) => {
                    const capa = livro.imagemUrl || "https://via.placeholder.com/300x400/4B0080/FFFFFF?text=Capa";
                    const card = document.createElement('article');
                    card.className = 'book-card';
                    card.innerHTML = `
                        <div class="book-cover-container"><img src="${capa}" alt="Capa"></div>
                        <div class="card-content">
                            <div><h3>${livro.titulo}</h3><p class="category">${livro.genero}</p></div>
                            <button class="btn btn-primary" onclick="abrirModal(${index})">Ver mais</button>
                        </div>`;
                    container.appendChild(card);
                });
            } catch (error) { console.error(error); }
        }

        function abrirModal(index) {
            livroAtual = livrosGlobal[index];
            document.getElementById('modal-img').src = livroAtual.imagemUrl || "https://via.placeholder.com/300";
            document.getElementById('modal-titulo').innerText = livroAtual.titulo;
            document.getElementById('modal-autor').innerText = "Autor: " + livroAtual.autor;
            document.getElementById('modal-categoria').innerText = livroAtual.genero;
            document.getElementById('modal-ano').innerText = "Ano: " + livroAtual.ano_publicacao;
            document.getElementById('modal-isbn').innerText = "ISBN: " + livroAtual.isbn;
            document.getElementById('modal-edicao').innerText = "Edi√ß√£o: " + livroAtual.edicao;
            document.getElementById('modal-qtd').innerText = "Dispon√≠veis: " + livroAtual.quantidade_disponivel;
            document.getElementById('modal-sinopse').innerText = livroAtual.sinopse || "Sinopse n√£o informada.";
            document.getElementById('modalLivro').style.display = 'flex';
        }

        function fecharModal(event) { document.getElementById('modalLivro').style.display = 'none'; }
        function irParaContato() { window.location.href = "about.html"; }

        function adicionarMinhaLista() {
            if (!livroAtual) return;
            let biblioteca = JSON.parse(localStorage.getItem("minhaBiblioteca")) || [];
            const jaExiste = biblioteca.some(b => b.isbn === livroAtual.isbn); // Usando ISBN como ID

            if (jaExiste) {
                alert("Este livro j√° est√° na sua lista!");
            } else {
                // SALVA O OBJETO COMPLETO AGORA
                biblioteca.push(livroAtual);
                localStorage.setItem("minhaBiblioteca", JSON.stringify(biblioteca));
                alert("‚úÖ Livro adicionado √† Minha Biblioteca com sucesso!");
            }
        }

        document.addEventListener("DOMContentLoaded", carregarLivrosDoBanco);
    </script>
</body>
</html>