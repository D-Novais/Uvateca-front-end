
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Uvateca - Categorias</title>
    <link rel="stylesheet" href="styles.css">
    
    <style>
        .search-container {
            margin-bottom: 2rem;
            display: flex;
            gap: 10px;
        }
        
        .search-input {
            flex: 1;
            padding: 12px;
            border-radius: 25px;
            border: none;
            font-size: 1rem;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        .filter-sidebar {
            height: fit-content;
            position: sticky;
            top: 100px;
        }
    </style>
</head>
<body>

    <header class="main-header">
        <a href="index.html" class="logo">Uvateca</a>
        <nav class="main-nav">
            <ul>
                <li><a href="index.html">In√≠cio</a></li>
                <li><a href="categoria.html">Categoria</a></li>
                <li><a href="about.html">Contato</a></li>
            </ul>
        </nav>
        <div class="user-icon"><a href="#" id="user-icon-btn"><img src="menu.png" class="user-icon-img"></a></div>
    </header>

    <aside id="user-sidebar" class="sidebar">
        <div id="sidebar-logado" class="sidebar-profile" style="display:none;"><img src="perfil.jpeg"><p id="welcome-msg-text"></p></div>
        <div id="sidebar-deslogado" class="sidebar-profile"><p>Deslogado</p></div>
        <nav class="sidebar-nav">
            <ul>
                <li id="nav-dashboard" style="display:none;"><a href="dashboard.html">Dashboard</a></li> 
                <li id="nav-cadastrar-funcionario" style="display:none;"><a href="painel-admin.html">Cadastrar Funcion√°rio</a></li> 
                <li id="nav-cadastrar-usuario" style="display:none;"><a href="cadastro-usuario.html">Cadastrar Usu√°rio</a></li>
                <li id="nav-registrar-livro" style="display:none;"><a href="cadastro-livro.html">Registrar Livro</a></li>
                <li id="nav-realizar-aluguel" style="display:none;"><a href="alugar-livro.html">Realizar Aluguel</a></li>
                <li id="nav-gestao-leitores" style="display:none;"><a href="gestao-leitores.html">üë• Gest√£o de Leitores</a></li>
                <li id="nav-acervo" style="display:none;"><a href="gestao-acervo.html">üìö Acervo Bibliogr√°fico</a></li>
                <li id="nav-gestao-emprestimos" style="display:none;"><a href="gestao-emprestimos.html">ü§ù Gest√£o de Empr√©stimos</a></li>
                <li id="nav-gestao-funcionarios" style="display: none;"><a href="gestao-funcionarios.html">üëî Gest√£o de Funcion√°rios</a></li>
                <li id="nav-biblioteca" style="display:none;"><a href="minha-biblioteca.html">Minha Biblioteca</a></li>
                <li id="nav-alugados" style="display:none;"><a href="alugados.html">Meus Alugu√©is</a></li>
                <li id="nav-login"><a href="login.html">Login / Entrar</a></li>
                <li id="nav-logout" style="display:none;"><a href="#">Sair (Logout)</a></li>
            </ul>
        </nav>
    </aside>

    <main>
        <div class="container">
            <h2>Explorar Acervo</h2>
            
            <section class="filter-section">
                
                <aside class="filter-sidebar">
                    <h3>Filtros</h3>
                    <form id="form-filtros" onsubmit="event.preventDefault()">
                        <div class="form-group">
                            <label for="filtro-categoria">Categoria</label>
                            <select id="filtro-categoria" onchange="aplicarFiltros()">
                                <option value="">Todas</option>
                                <option value="Fic√ß√£o">Fic√ß√£o</option>
                                <option value="T√©cnico">T√©cnico</option>
                                <option value="Romance">Romance</option>
                                <option value="Terror">Terror</option>
                                <option value="Fantasia">Fantasia</option>
                                <option value="Biografia">Biografia</option>
                                <option value="Hist√≥ria">Hist√≥ria</option>
                                <option value="Infantil">Infantil</option>
                                <option value="Aventura">Aventura</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="filtro-ano">Ano de Publica√ß√£o</label>
                            <input type="number" id="filtro-ano" placeholder="Ex: 2024" oninput="aplicarFiltros()">
                        </div>
                        <button class="btn btn-secondary btn-full-width" onclick="limparFiltros()">Limpar Filtros</button>
                    </form>
                </aside>

                <div style="flex: 1;">
                    <div class="search-container">
                        <input type="text" id="barra-pesquisa" class="search-input" placeholder="Pesquise por t√≠tulo ou autor..." oninput="aplicarFiltros()">
                    </div>
                    <div class="book-grid" id="lista-livros-dinamica">
                        <p style="color: white;">Carregando livros...</p>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <div id="modalLivro" class="modal-overlay" onclick="fecharModal(event)">
        <div class="modal-box" onclick="event.stopPropagation()">
            <span class="close-modal" onclick="fecharModal(event)">&times;</span>
            <div class="modal-left"><img id="modal-img" src="" alt="Capa"></div>
            <div class="modal-right">
                <h2 id="modal-titulo" class="modal-title">T√≠tulo</h2>
                <div class="modal-meta">
                    <span id="modal-autor">Autor</span> | <span id="modal-categoria">Cat</span> | <span id="modal-ano">Ano</span>
                </div>
                <div class="modal-meta" style="border:none; padding:0; font-size:1rem;">
                    <span id="modal-isbn">ISBN</span> | <span id="modal-edicao">Ed</span> | <span id="modal-qtd">Qtd</span>
                </div>
                <div style="margin-top:30px;">
                    <p class="modal-sinopse-label">Sinopse</p>
                    <p id="modal-sinopse" class="modal-sinopse-text">Desc...</p>
                </div>
                
                <div class="modal-actions">
                    <button class="modal-action-btn" onclick="irParaContato()">Entre em Contato</button>
                    <button class="modal-action-btn" onclick="adicionarMinhaLista()">Adicionar √† minha lista</button>
                </div>
            </div>
        </div>
    </div>

    <script src="main.js"></script>
    <script>
        const API_URL = "http://localhost:8080/api";
        let todosLivros = []; 
        let livroAtual = null; // Guarda o livro aberto no modal

        document.addEventListener("DOMContentLoaded", async () => {
            const container = document.getElementById('lista-livros-dinamica');
            try {
                const response = await fetch(`${API_URL}/livros`);
                todosLivros = await response.json();
                renderizarLivros(todosLivros);
            } catch (error) {
                container.innerHTML = '<p style="color:red">Erro ao conectar com o servidor.</p>';
                console.error(error);
            }
        });

        function aplicarFiltros() {
            const termoPesquisa = document.getElementById('barra-pesquisa').value.toLowerCase();
            const categoriaSelecionada = document.getElementById('filtro-categoria').value;
            const anoSelecionado = document.getElementById('filtro-ano').value;

            const livrosFiltrados = todosLivros.filter(livro => {
                const matchTexto = livro.titulo.toLowerCase().includes(termoPesquisa) || 
                                   livro.autor.toLowerCase().includes(termoPesquisa);
                const matchCategoria = categoriaSelecionada === "" || livro.genero === categoriaSelecionada;
                const matchAno = anoSelecionado === "" || livro.ano_publicacao == anoSelecionado;
                return matchTexto && matchCategoria && matchAno;
            });
            renderizarLivros(livrosFiltrados);
        }

        function renderizarLivros(lista) {
            const container = document.getElementById('lista-livros-dinamica');
            container.innerHTML = "";

            if (lista.length === 0) {
                container.innerHTML = '<p style="color:white; font-size:1.2rem;">Nenhum livro encontrado com esses filtros.</p>';
                return;
            }

            lista.forEach((livro) => {
                const capa = livro.imagemUrl || "https://via.placeholder.com/300x400/4B0080/FFFFFF?text=Capa";
                const card = document.createElement('article');
                card.className = 'book-card';
                card.innerHTML = `
                    <div class="book-cover-container">
                        <img src="${capa}" alt="Capa de ${livro.titulo}">
                    </div>
                    <div class="card-content">
                        <div>
                            <h3>${livro.titulo}</h3>
                            <p class="category">${livro.genero}</p>
                        </div>
                        <button class="btn btn-primary" onclick='abrirModalPorObjeto(${JSON.stringify(livro).replace(/'/g, "&#39;")})'>Ver mais</button>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function limparFiltros() {
            document.getElementById('barra-pesquisa').value = "";
            document.getElementById('filtro-categoria').value = "";
            document.getElementById('filtro-ano').value = "";
            renderizarLivros(todosLivros);
        }

        // --- FUN√á√ïES DO MODAL ---

        function abrirModalPorObjeto(livro) {
            livroAtual = livro; // Salva o livro atual para o bot√£o "Adicionar"

            document.getElementById('modal-img').src = livro.imagemUrl || "https://via.placeholder.com/300";
            document.getElementById('modal-titulo').innerText = livro.titulo;
            document.getElementById('modal-autor').innerText = "Autor: " + livro.autor;
            document.getElementById('modal-categoria').innerText = livro.genero;
            document.getElementById('modal-ano').innerText = "Ano: " + livro.ano_publicacao;
            document.getElementById('modal-isbn').innerText = "ISBN: " + livro.isbn;
            document.getElementById('modal-edicao').innerText = "Edi√ß√£o: " + livro.edicao;
            document.getElementById('modal-qtd').innerText = "Disp: " + livro.quantidade_disponivel;
            document.getElementById('modal-sinopse').innerText = livro.sinopse || "Sem sinopse.";
            
            document.getElementById('modalLivro').style.display = 'flex';
        }

        function fecharModal(event) {
            document.getElementById('modalLivro').style.display = 'none';
        }

        // --- A√á√ïES DOS BOT√ïES ---

        function irParaContato() {
            window.location.href = "about.html";
        }

        function adicionarMinhaLista() {
            if (!livroAtual) return;

            let biblioteca = JSON.parse(localStorage.getItem("minhaBiblioteca")) || [];
            // Usa ISBN para verificar duplicidade
            const jaExiste = biblioteca.some(b => b.isbn === livroAtual.isbn || b.id === livroAtual.isbn);

            if (jaExiste) {
                alert("Este livro j√° est√° na sua lista!");
            } else {
                // Adiciona o objeto completo √† lista
                biblioteca.push(livroAtual);
                localStorage.setItem("minhaBiblioteca", JSON.stringify(biblioteca));
                alert("‚úÖ Livro adicionado √† Minha Biblioteca com sucesso!");
            }
        }
    </script>
</body>
</html>
