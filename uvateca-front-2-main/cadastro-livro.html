<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Uvateca - Registrar Livro</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>

    <header class="main-header">
        <a href="index.html" class="logo">Uvateca</a>
        <div class="user-icon">
            <a href="#" id="user-icon-btn">
                <img src="menu.png" class="user-icon-img" alt="Menu">
            </a> 
        </div>
    </header>

    <aside id="user-sidebar" class="sidebar">
        
        <div id="sidebar-logado" class="sidebar-profile" style="display: none;">
            <img src="perfil.jpeg" alt="Foto do Perfil">
            <p class="welcome-msg" id="welcome-msg-text">Bem-vindo!</p> 
        </div>

        <div id="sidebar-deslogado" class="sidebar-profile">
            <p class="welcome-msg">Voc√™ n√£o est√° logado.</p>
        </div>
        
        <nav class="sidebar-nav">
            <ul>
                <li id="nav-dashboard" style="display: none;"><a href="dashboard.html">Dashboard</a></li> 
                <li id="nav-gestao-funcionarios" style="display: none;"><a href="gestao-funcionarios.html">üëî Gest√£o de Funcion√°rios</a></li> 
                
                <li id="nav-gestao-leitores" style="display: none;"><a href="gestao-leitores.html">üë• Gest√£o de Leitores</a></li>
                <li id="nav-acervo" style="display: none;"><a href="gestao-acervo.html">üìö Acervo Bibliogr√°fico</a></li>
                <li id="nav-gestao-emprestimos" style="display: none;"><a href="gestao-emprestimos.html">ü§ù Gest√£o de Empr√©stimos</a></li>

                <li id="nav-biblioteca" style="display: none;"><a href="minha-biblioteca.html">Minha Biblioteca</a></li>
                <li id="nav-alugados" style="display: none;"><a href="alugados.html">Meus Alugu√©is</a></li>
                
                <li id="nav-login"><a href="login.html">Login</a></li>
                <li id="nav-logout" style="display: none;"><a href="#">Sair</a></li>
            </ul>
        </nav>
    </aside>

    <main>
        <div class="container">
            <h2>Gerenciamento de Acervo</h2>
            <div class="form-container">
                <h3>Registrar Novo Livro</h3>
                
                <form id="form-cadastro-livro">
                    <div class="form-group">
                        <label for="titulo">T√≠tulo</label>
                        <input type="text" id="titulo" name="titulo" required>
                    </div>

                    <div class="form-group">
                        <label for="autor">Autor</label>
                        <input type="text" id="autor" name="autor" required>
                    </div>

                    <div class="form-group">
                        <label for="isbn">ISBN</label>
                        <input type="text" id="isbn" name="isbn" required placeholder="Ex: 978-85-333">
                    </div>

                    <div class="form-group">
                        <label for="imagemUrl">Link da Imagem da Capa (URL)</label>
                        <input type="text" id="imagemUrl" name="imagemUrl" placeholder="Ex: https://site.com/foto.jpg">
                        <small style="color: #666; font-size: 0.85rem;">Cole o link direto da imagem aqui.</small>
                    </div>

                    <div class="form-group">
                        <label for="ano">Ano</label>
                        <input type="number" id="ano" name="ano" required placeholder="2024">
                    </div>

                    <div class="form-group">
                        <label for="edicao">Edi√ß√£o</label>
                        <input type="text" id="edicao" name="edicao" placeholder="1¬™ Edi√ß√£o">
                    </div>

                    <div class="form-group">
                        <label for="quantidade">Quantidade Dispon√≠vel</label>
                        <input type="number" id="quantidade" name="quantidade" required value="1">
                    </div>

                    <div class="form-group">
                        <label for="categoria">Categoria</label>
                        <select id="categoria" name="categoria">
                            <option value="Fic√ß√£o">Fic√ß√£o</option>
                            <option value="T√©cnico">T√©cnico</option>
                            <option value="Romance">Romance</option>
                            <option value="Terror">Terror</option>
                            <option value="Fantasia">Fantasia</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="sinopse">Sinopse</label>
                        <textarea id="sinopse" name="sinopse" rows="4" placeholder="Breve descri√ß√£o..."></textarea>
                    </div>

                    <button type="submit" class="btn btn-secondary">Salvar no Banco</button>
                </form>
            </div>
        </div>
    </main>

    <script src="main.js"></script>

    <script>
        document.getElementById('form-cadastro-livro').addEventListener('submit', async function(e) {
            e.preventDefault();
            const API_URL = "http://localhost:8080/api";
            
            // Imagem padr√£o caso o campo fique vazio
            const imgPadrao = "https://via.placeholder.com/300x400/4B0080/FFFFFF?text=Sem+Capa";
            const urlDigitada = document.getElementById('imagemUrl').value.trim();

            const novoLivro = {
                titulo: document.getElementById('titulo').value,
                autor: document.getElementById('autor').value,
                genero: document.getElementById('categoria').value,
                isbn: document.getElementById('isbn').value,
                edicao: document.getElementById('edicao').value || "1¬™ Edi√ß√£o", 
                sinopse: document.getElementById('sinopse').value || "Sem sinopse",
                ano_publicacao: parseInt(document.getElementById('ano').value),
                quantidade_disponivel: parseInt(document.getElementById('quantidade').value),
                // Envia a URL ou a imagem padr√£o
                imagemUrl: urlDigitada || imgPadrao 
            };

            try {
                const response = await fetch(`${API_URL}/livros`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(novoLivro)
                });

                if (response.ok) {
                    alert("‚úÖ Livro registrado com sucesso!");
                    e.target.reset(); // Limpa o formul√°rio
                } else {
                    const textoErro = await response.text();
                    alert("‚ùå Erro ao registrar: " + textoErro);
                }
            } catch (error) {
                console.error(error);
                alert("‚ùå Erro de conex√£o. O servidor est√° ligado?");
            }
        });
    </script>
</body>
</html>